<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microbit Robot Controller</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Space Mono for that 'tech' feel -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* BBC Microbit Color Palette */
            --bg-color: #1a1a1a;
            --panel-color: #000000;
            --accent-green: #00E463; /* Microbit Logo Green */
            --accent-red: #FF0000;    /* LED Matrix Red */
            --text-color: #ffffff;
            --connector-gold: #E7A600;
            --tab-inactive: #333333;
        }

        body {
            font-family: 'Space Mono', monospace;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow-x: hidden;
            touch-action: manipulation;
        }

        /* --- Buttons --- */
        .connect-btn {
            background-color: #333;
            border: 2px solid var(--accent-green);
            color: var(--accent-green);
            transition: all 0.3s ease;
        }
        
        .connect-btn:hover {
            background-color: var(--accent-green);
            color: black;
        }

        .connect-btn.connected {
            background-color: var(--accent-green);
            color: black;
            box-shadow: 0 0 20px var(--accent-green);
        }

        .help-btn {
            background-color: transparent;
            border: 2px solid #555;
            color: #888;
            transition: all 0.2s ease;
        }
        
        .help-btn:hover {
            border-color: var(--connector-gold);
            color: var(--connector-gold);
        }

        /* D-Pad / Tank Styling */
        .dpad-btn {
            background-color: #222;
            border: 2px solid #444;
            color: #666;
            transition: all 0.1s;
            font-weight: bold;
        }

        .dpad-btn.active {
            background-color: var(--accent-red);
            border-color: var(--accent-red);
            color: white;
            box-shadow: 0 0 15px var(--accent-red);
            transform: scale(0.95);
        }

        /* Speaker Button */
        .speaker-btn {
            background-color: #222;
            border: 2px solid var(--connector-gold);
            color: var(--connector-gold);
            border-radius: 50%;
            transition: all 0.1s;
        }

        .speaker-btn.active {
            background-color: var(--connector-gold);
            color: black;
            transform: scale(0.90);
            box-shadow: 0 0 15px var(--connector-gold);
        }

        /* Keyboard Key Styling for Servos */
        .key-btn {
            background-color: #222;
            border: 1px solid #444;
            border-bottom: 4px solid #111; /* Key depth look */
            border-radius: 6px;
            color: white;
            transition: all 0.05s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            min-height: 80px;
        }

        .key-btn:active, .key-btn.active {
            transform: translateY(3px); /* Press down effect */
            border-bottom: 1px solid #111;
            background-color: #333;
            color: var(--accent-green);
            box-shadow: 0 0 10px rgba(0, 228, 99, 0.2);
            border-color: var(--accent-green);
        }

        .key-btn.close-btn:active, .key-btn.close-btn.active {
             color: var(--connector-gold);
             border-color: var(--connector-gold);
             box-shadow: 0 0 10px rgba(231, 166, 0, 0.2);
        }

        .led-dot {
            width: 8px;
            height: 8px;
            background-color: #333;
            border-radius: 2px;
        }
        .led-dot.on {
            background-color: var(--accent-red);
            box-shadow: 0 0 4px var(--accent-red);
        }

        /* Tab Styling */
        .tab-btn {
            background-color: var(--tab-inactive);
            color: #888;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tab-btn.active {
            background-color: var(--panel-color);
            color: var(--accent-green);
            border-top: 2px solid var(--accent-green);
        }

    </style>
</head>
<body class="flex flex-col h-screen max-h-screen">

    <!-- Header -->
    <header class="p-4 flex justify-between items-center border-b border-gray-800 bg-black flex-none">
        <div class="flex items-center gap-3">
            <div class="w-8 h-6 bg-black border border-white rounded-sm flex items-center justify-center gap-[2px]">
                <div class="led-dot on"></div>
                <div class="led-dot"></div>
                <div class="led-dot on"></div>
            </div>
            <div class="flex flex-col">
                <h1 class="text-xl font-bold tracking-wider text-green-400 leading-none">MICRO:BIT<span class="text-white text-sm ml-2 opacity-70">CONTROL</span></h1>
                <span class="text-[9px] text-gray-500 tracking-widest mt-1">BLE INTERFACE V1.1</span>
            </div>
        </div>
        <div class="flex gap-2">
            <a href="help.html" class="help-btn px-4 py-2 rounded-md font-bold text-sm tracking-widest flex items-center gap-2 no-underline">
                <span>?</span> HELP
            </a>
            <button id="connectBtn" class="connect-btn px-6 py-2 rounded-md font-bold text-sm tracking-widest flex items-center gap-2">
                <span id="btIcon">âš¡</span>
                <span id="btText">CONNECT</span>
            </button>
        </div>
    </header>

    <!-- Main Control Area -->
    <main class="flex-grow flex flex-col md:flex-row p-4 gap-6 items-stretch justify-center overflow-hidden">

        <!-- Left Column: Driving Controls -->
        <div class="w-full md:w-1/2 flex flex-col bg-black rounded-xl border border-gray-800 shadow-2xl relative order-2 md:order-1 overflow-hidden">
             
            <!-- Decorative Gold Line -->
             <div class="absolute bottom-0 left-0 w-full h-2 bg-gradient-to-r from-yellow-600 to-yellow-400 rounded-b-xl opacity-80 z-10"></div>

            <!-- Tabs -->
            <div class="flex w-full border-b border-gray-800 h-12 flex-none">
                <button id="tabWASD" class="tab-btn flex-1 font-bold tracking-widest text-sm active" onclick="switchMode('WASD')">WASD MODE</button>
                <button id="tabTank" class="tab-btn flex-1 font-bold tracking-widest text-sm" onclick="switchMode('TANK')">L/R TANK MODE</button>
            </div>

            <!-- Content Container -->
            <div class="flex-grow relative p-6 flex items-center justify-center">

                <!-- WASD Panel -->
                <div id="panelWASD" class="w-full h-full flex flex-col items-center justify-center transition-opacity duration-200">
                    <div class="grid grid-cols-3 grid-rows-3 gap-3 w-full max-w-[400px] aspect-square">
                        <!-- Top Row -->
                        <div></div>
                        <button id="btnUp" class="dpad-btn rounded-t-lg flex flex-col items-center justify-center hover:bg-gray-800">
                            <span class="text-2xl">â–²</span>
                            <span class="text-[10px] opacity-50">W</span>
                        </button>
                        <div></div>
                        
                        <!-- Middle Row -->
                        <button id="btnLeft" class="dpad-btn rounded-l-lg flex flex-col items-center justify-center hover:bg-gray-800">
                            <span class="text-2xl">â—€</span>
                            <span class="text-[10px] opacity-50">A</span>
                        </button>
                        
                        <!-- Center Speaker -->
                        <div class="flex items-center justify-center">
                            <button id="btnSpeaker" class="speaker-btn w-16 h-16 flex flex-col items-center justify-center shadow-lg" title="Horn (Spacebar)">
                                <span class="text-xl">ðŸ”Š</span>
                                <span class="text-[8px] mt-1 opacity-70">SPACE</span>
                            </button>
                        </div>
        
                        <button id="btnRight" class="dpad-btn rounded-r-lg flex flex-col items-center justify-center hover:bg-gray-800">
                            <span class="text-2xl">â–¶</span>
                            <span class="text-[10px] opacity-50">D</span>
                        </button>
                        
                        <!-- Bottom Row -->
                        <div></div>
                        <button id="btnDown" class="dpad-btn rounded-b-lg flex flex-col items-center justify-center hover:bg-gray-800">
                            <span class="text-2xl">â–¼</span>
                            <span class="text-[10px] opacity-50">S</span>
                        </button>
                        <div></div>
                    </div>
                </div>

                <!-- Tank Panel (Hidden by default) -->
                <div id="panelTank" class="hidden w-full h-full flex items-center justify-center gap-4 max-w-[400px]">
                    
                    <!-- Left Track -->
                    <div class="flex-1 h-full flex flex-col gap-2">
                        <div class="text-center text-[10px] text-gray-500 font-mono tracking-widest">LEFT MOTOR</div>
                        <button id="btnL_Fwd" class="dpad-btn flex-1 rounded-t-lg flex flex-col items-center justify-center hover:bg-gray-800 text-2xl" onmousedown="startTank('leftforward', this)" onmouseup="stopTank(this)" onmouseleave="stopTank(this)" ontouchstart="startTank('leftforward', this)" ontouchend="stopTank(this)">
                            â–² <span class="text-[10px] opacity-50">1</span>
                        </button>
                        <button id="btnL_Back" class="dpad-btn flex-1 rounded-b-lg flex flex-col items-center justify-center hover:bg-gray-800 text-2xl" onmousedown="startTank('leftbackward', this)" onmouseup="stopTank(this)" onmouseleave="stopTank(this)" ontouchstart="startTank('leftbackward', this)" ontouchend="stopTank(this)">
                            â–¼ <span class="text-[10px] opacity-50">Q</span>
                        </button>
                    </div>

                    <!-- Center Speaker (Tank) -->
                    <div class="flex items-center justify-center">
                        <button id="btnSpeakerTank" class="speaker-btn w-16 h-16 flex flex-col items-center justify-center shadow-lg" title="Horn (Spacebar)">
                            <span class="text-xl">ðŸ”Š</span>
                            <span class="text-[8px] mt-1 opacity-70">SPACE</span>
                        </button>
                    </div>

                    <!-- Right Track -->
                    <div class="flex-1 h-full flex flex-col gap-2">
                        <div class="text-center text-[10px] text-gray-500 font-mono tracking-widest">RIGHT MOTOR</div>
                        <button id="btnR_Fwd" class="dpad-btn flex-1 rounded-t-lg flex flex-col items-center justify-center hover:bg-gray-800 text-2xl" onmousedown="startTank('rightforward', this)" onmouseup="stopTank(this)" onmouseleave="stopTank(this)" ontouchstart="startTank('rightforward', this)" ontouchend="stopTank(this)">
                            â–² <span class="text-[10px] opacity-50">3</span>
                        </button>
                        <button id="btnR_Back" class="dpad-btn flex-1 rounded-b-lg flex flex-col items-center justify-center hover:bg-gray-800 text-2xl" onmousedown="startTank('rightbackward', this)" onmouseup="stopTank(this)" onmouseleave="stopTank(this)" ontouchstart="startTank('rightbackward', this)" ontouchend="stopTank(this)">
                            â–¼ <span class="text-[10px] opacity-50">E</span>
                        </button>
                    </div>

                </div>

            </div>
        </div>

        <!-- Right Column: Servo Keyboard Grid (Right) -->
        <div class="w-full md:w-1/2 flex flex-col p-6 bg-black rounded-xl border border-gray-800 shadow-2xl relative order-1 md:order-2">
            <!-- Decorative Gold Edge Connector line -->
            <div class="absolute bottom-0 left-0 w-full h-2 bg-gradient-to-r from-yellow-600 to-yellow-400 rounded-b-xl opacity-80"></div>
            
            <div class="flex justify-between items-center mb-1 border-b border-gray-800 pb-2">
                <div class="flex flex-col">
                    <h2 class="text-xs font-bold text-gray-400 tracking-widest">MANIPULATOR ARMS</h2>
                    <span class="text-[9px] text-gray-600 font-mono">CONTROLS MOTORS ON PINS 13-16</span>
                </div>
                <div class="text-[10px] text-gray-600 font-mono">MANUAL STEP MODE</div>
            </div>

            <!-- Keyboard Layout Grid -->
            <div class="grid grid-cols-4 gap-3 h-full pb-4 pt-2">
                
                <!-- Headers -->
                <div class="flex flex-col items-center justify-end pb-2">
                    <div class="text-center text-green-400 font-bold text-base uppercase tracking-wider leading-none mb-1">PIN 13</div>
                    <div class="text-[10px] text-white font-mono bg-gray-800 px-2 py-0.5 rounded">SERVO 1</div>
                </div>
                <div class="flex flex-col items-center justify-end pb-2">
                    <div class="text-center text-green-400 font-bold text-base uppercase tracking-wider leading-none mb-1">PIN 14</div>
                    <div class="text-[10px] text-white font-mono bg-gray-800 px-2 py-0.5 rounded">SERVO 2</div>
                </div>
                <div class="flex flex-col items-center justify-end pb-2">
                    <div class="text-center text-green-400 font-bold text-base uppercase tracking-wider leading-none mb-1">PIN 15</div>
                    <div class="text-[10px] text-white font-mono bg-gray-800 px-2 py-0.5 rounded">SERVO 3</div>
                </div>
                <div class="flex flex-col items-center justify-end pb-2">
                    <div class="text-center text-green-400 font-bold text-base uppercase tracking-wider leading-none mb-1">PIN 16</div>
                    <div class="text-[10px] text-white font-mono bg-gray-800 px-2 py-0.5 rounded">SERVO 4</div>
                </div>

                <!-- Row 1: CLOSE Controls (Number Keys 7-0) -->
                <button id="s1_close" class="key-btn close-btn" data-cmd="pin13close">
                    <span class="text-2xl font-bold">7</span>
                    <span class="text-[9px] opacity-50 mt-1">CLOSE</span>
                </button>

                <button id="s2_close" class="key-btn close-btn" data-cmd="pin14close">
                    <span class="text-2xl font-bold">8</span>
                    <span class="text-[9px] opacity-50 mt-1">CLOSE</span>
                </button>

                <button id="s3_close" class="key-btn close-btn" data-cmd="pin15close">
                    <span class="text-2xl font-bold">9</span>
                    <span class="text-[9px] opacity-50 mt-1">CLOSE</span>
                </button>

                <button id="s4_close" class="key-btn close-btn" data-cmd="pin16close">
                    <span class="text-2xl font-bold">0</span>
                    <span class="text-[9px] opacity-50 mt-1">CLOSE</span>
                </button>


                <!-- Row 2: OPEN Controls (Letter Keys U-P) -->
                <button id="s1_open" class="key-btn" data-cmd="pin13open">
                    <span class="text-2xl font-bold">U</span>
                    <span class="text-[9px] opacity-50 mt-1">OPEN</span>
                </button>

                <button id="s2_open" class="key-btn" data-cmd="pin14open">
                    <span class="text-2xl font-bold">I</span>
                    <span class="text-[9px] opacity-50 mt-1">OPEN</span>
                </button>

                <button id="s3_open" class="key-btn" data-cmd="pin15open">
                    <span class="text-2xl font-bold">O</span>
                    <span class="text-[9px] opacity-50 mt-1">OPEN</span>
                </button>

                <button id="s4_open" class="key-btn" data-cmd="pin16open">
                    <span class="text-2xl font-bold">P</span>
                    <span class="text-[9px] opacity-50 mt-1">OPEN</span>
                </button>

            </div>

        </div>

    </main>

    <!-- Footer / Log -->
    <footer class="p-2 bg-black border-t border-gray-900 text-center flex-none">
        <div id="statusLog" class="text-xs text-gray-500 font-mono">> WAITING FOR INPUT...</div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- Configuration ---
        const UART_SERVICE_UUID = "6e400001-b5a3-f393-e0a9-e50e24dcca9e";
        const UART_TX_CHARACTERISTIC_UUID = "6e400002-b5a3-f393-e0a9-e50e24dcca9e";
        const UART_RX_CHARACTERISTIC_UUID = "6e400003-b5a3-f393-e0a9-e50e24dcca9e";

        // --- State ---
        let uBitDevice;
        let rxCharacteristic;
        let connected = false;
        let drivingMode = 'WASD'; // 'WASD' or 'TANK'

        // --- UI Elements ---
        const connectBtn = document.getElementById('connectBtn');
        const statusLog = document.getElementById('statusLog');
        
        const btnUp = document.getElementById('btnUp');
        const btnDown = document.getElementById('btnDown');
        const btnLeft = document.getElementById('btnLeft');
        const btnRight = document.getElementById('btnRight');
        const btnSpeaker = document.getElementById('btnSpeaker');
        
        // Tank UI Buttons
        const btnL_Fwd = document.getElementById('btnL_Fwd');
        const btnL_Back = document.getElementById('btnL_Back');
        const btnR_Fwd = document.getElementById('btnR_Fwd');
        const btnR_Back = document.getElementById('btnR_Back');
        const btnSpeakerTank = document.getElementById('btnSpeakerTank');


        // --- UI Switching ---
        function switchMode(mode) {
            drivingMode = mode;
            const tabWASD = document.getElementById('tabWASD');
            const tabTank = document.getElementById('tabTank');
            const panelWASD = document.getElementById('panelWASD');
            const panelTank = document.getElementById('panelTank');

            if (mode === 'WASD') {
                tabWASD.classList.add('active');
                tabTank.classList.remove('active');
                panelWASD.classList.remove('hidden');
                panelTank.classList.add('hidden');
                log("> MODE: STANDARD WASD");
            } else {
                tabWASD.classList.remove('active');
                tabTank.classList.add('active');
                panelWASD.classList.add('hidden');
                panelTank.classList.remove('hidden');
                log("> MODE: L/R TANK CONTROL");
            }
        }

        // --- Bluetooth Functions ---
        async function connect() {
            try {
                log("> REQUESTING DEVICE...");
                uBitDevice = await navigator.bluetooth.requestDevice({
                    filters: [{ namePrefix: "BBC micro:bit" }],
                    optionalServices: [UART_SERVICE_UUID]
                });
                uBitDevice.addEventListener('gattserverdisconnected', onDisconnected);
                const server = await uBitDevice.gatt.connect();
                const service = await server.getPrimaryService(UART_SERVICE_UUID);
                const txCharacteristic = await service.getCharacteristic(UART_TX_CHARACTERISTIC_UUID);
                txCharacteristic.startNotifications();
                txCharacteristic.addEventListener("characteristicvaluechanged", onTxCharacteristicValueChanged);
                rxCharacteristic = await service.getCharacteristic(UART_RX_CHARACTERISTIC_UUID);
                connected = true;
                updateConnectionUI();
                log("> CONNECTED_");
            } catch (error) {
                log("> ERROR: " + error);
                console.error(error);
            }
        }

        function disconnect() {
            if (!uBitDevice) return;
            if (uBitDevice.gatt.connected) {
                uBitDevice.gatt.disconnect();
            }
        }

        function onDisconnected(event) {
            connected = false;
            updateConnectionUI();
            log("> DISCONNECTED_");
        }

        function updateConnectionUI() {
            const btText = document.getElementById('btText');
            if (connected) {
                connectBtn.classList.add('connected');
                btText.innerText = "DISCONNECT";
            } else {
                connectBtn.classList.remove('connected');
                btText.innerText = "CONNECT";
            }
        }

        let queue = Promise.resolve();
        function queueGattOperation(operation) {
            queue = queue.then(operation, operation);
            return queue;
        }

        async function sendUART(data) {
            log("> SENDING: " + data);
            if (!connected || !rxCharacteristic) {
                console.log("Simulated Send:", data);
                return;
            }
            let encoder = new TextEncoder();
            let stringData = data + "\n"; 
            queueGattOperation(() => rxCharacteristic.writeValue(encoder.encode(stringData))
                .catch(error => console.error('Write Error:', error)));
        }

        function onTxCharacteristicValueChanged(event) {
            let receivedData = new TextDecoder().decode(event.target.value);
            console.log("RX:", receivedData);
        }

        function log(msg) {
            statusLog.innerText = msg;
        }

        connectBtn.addEventListener('click', () => {
            if (connected) disconnect();
            else connect();
        });

        // --- Tank Mode Helpers ---
        // Need to expose these to global scope for the inline HTML handlers
        window.startTank = function(cmd, el) {
            el.classList.add('active');
            sendUART(cmd);
        }
        window.stopTank = function(el) {
            el.classList.remove('active');
            sendUART('stop');
        }

        // --- Keyboard Controls ---

        const servoKeyMap = {
            'u': { cmd: 'pin13open', id: 's1_open' },
            '7': { cmd: 'pin13close', id: 's1_close' },
            'i': { cmd: 'pin14open', id: 's2_open' },
            '8': { cmd: 'pin14close', id: 's2_close' },
            'o': { cmd: 'pin15open', id: 's3_open' },
            '9': { cmd: 'pin15close', id: 's3_close' },
            'p': { cmd: 'pin16open', id: 's4_open' },
            '0': { cmd: 'pin16close', id: 's4_close' }
        };

        document.addEventListener('keydown', (e) => {
            if (e.repeat) return; 
            const key = e.key.toLowerCase();

            // 1. Check Servos (Always Active)
            if (servoKeyMap[key]) {
                const mapping = servoKeyMap[key];
                const btn = document.getElementById(mapping.id);
                if (btn) btn.classList.add('active');
                sendUART(mapping.cmd);
                return;
            }

            // 2. Check Spacebar (Always Active)
            if (key === " ") {
                e.preventDefault();
                btnSpeaker.classList.add('active');
                btnSpeakerTank.classList.add('active'); // Highlight tank button too
                sendUART("beep");
                return;
            }

            // 3. Driving Controls (Depend on Mode)
            if (drivingMode === 'WASD') {
                switch(key) {
                    case "w":
                        btnUp.classList.add('active');
                        sendUART("forward"); 
                        break;
                    case "s":
                        btnDown.classList.add('active');
                        sendUART("backward"); 
                        break;
                    case "a":
                        btnLeft.classList.add('active');
                        sendUART("left");
                        break;
                    case "d":
                        btnRight.classList.add('active');
                        sendUART("right");
                        break;
                }
            } else {
                // TANK MODE (1/Q and 3/E)
                switch(key) {
                    case "1": // Left Fwd
                        btnL_Fwd.classList.add('active');
                        sendUART("leftforward");
                        break;
                    case "q": // Left Back
                        btnL_Back.classList.add('active');
                        sendUART("leftbackward");
                        break;
                    case "3": // Right Fwd
                        btnR_Fwd.classList.add('active');
                        sendUART("rightforward");
                        break;
                    case "e": // Right Back
                        btnR_Back.classList.add('active');
                        sendUART("rightbackward");
                        break;
                }
            }
        });

        document.addEventListener('keyup', (e) => {
            const key = e.key.toLowerCase();

            // 1. Servos
            if (servoKeyMap[key]) {
                const mapping = servoKeyMap[key];
                const btn = document.getElementById(mapping.id);
                if (btn) btn.classList.remove('active');
                return;
            }

            // 2. Spacebar
            if (key === " ") {
                btnSpeaker.classList.remove('active');
                btnSpeakerTank.classList.remove('active');
                return;
            }

            // 3. Driving Release (Send Stop)
            const wasdKeys = ['w', 's', 'a', 'd'];
            const tankKeys = ['1', 'q', '3', 'e'];

            if (drivingMode === 'WASD' && wasdKeys.includes(key)) {
                btnUp.classList.remove('active');
                btnDown.classList.remove('active');
                btnLeft.classList.remove('active');
                btnRight.classList.remove('active');
                sendUART("stop");
            } 
            else if (drivingMode === 'TANK' && tankKeys.includes(key)) {
                btnL_Fwd.classList.remove('active');
                btnL_Back.classList.remove('active');
                btnR_Fwd.classList.remove('active');
                btnR_Back.classList.remove('active');
                sendUART("stop");
            }
        });

        // --- Touch/Mouse Logic for WASD D-Pad ---
        const setupButton = (btn, commandStart, commandEnd) => {
            const start = (e) => {
                if(e.cancelable) e.preventDefault();
                btn.classList.add('active');
                sendUART(commandStart);
            };
            const end = (e) => {
                if(e.cancelable) e.preventDefault();
                btn.classList.remove('active');
                if(commandEnd) sendUART(commandEnd);
            };

            btn.addEventListener('mousedown', start);
            btn.addEventListener('mouseup', end);
            btn.addEventListener('mouseleave', end);
            btn.addEventListener('touchstart', start);
            btn.addEventListener('touchend', end);
        };

        setupButton(btnUp, "forward", "stop"); 
        setupButton(btnDown, "backward", "stop"); 
        setupButton(btnLeft, "left", "stop");
        setupButton(btnRight, "right", "stop");
        setupButton(btnSpeaker, "beep", null);
        setupButton(btnSpeakerTank, "beep", null);


        // --- Touch/Mouse Logic for Servo Buttons ---
        document.querySelectorAll('.key-btn').forEach(btn => {
            const cmd = btn.getAttribute('data-cmd');
            if(!cmd) return;

            const start = (e) => {
                if(e.cancelable) e.preventDefault();
                btn.classList.add('active');
                sendUART(cmd); 
            };
            const end = (e) => {
                if(e.cancelable) e.preventDefault();
                btn.classList.remove('active');
            };

            btn.addEventListener('mousedown', start);
            btn.addEventListener('mouseup', end);
            btn.addEventListener('mouseleave', end);
            btn.addEventListener('touchstart', start);
            btn.addEventListener('touchend', end);
        });

    </script>
</body>
</html>
